Step 1: Create Tables

CREATE TABLE Borrower (
    Roll_no NUMBER(5),
    Name VARCHAR2(30),
    Date_of_Issue DATE,
    Name_of_Book VARCHAR2(50),
    Status CHAR(1)
);

CREATE TABLE Fine (
    Roll_no NUMBER(5),
    Date_ DATE,
    Amt NUMBER(10,2)
);

Step 2: Insert Sample Data

INSERT INTO Borrower VALUES (1, 'Ravi', TO_DATE('10-OCT-2024','DD-MON-YYYY'), 'DBMS', 'I');
INSERT INTO Borrower VALUES (2, 'Sneha', TO_DATE('25-SEP-2024','DD-MON-YYYY'), 'Python', 'I');
INSERT INTO Borrower VALUES (3, 'Amit', TO_DATE('05-NOV-2024','DD-MON-YYYY'), 'AI', 'I');
COMMIT;

Step 3: PL/SQL Anonymous Block

Use Control Structures and Exception Handling (Mandatory)

DECLARE
    v_roll Borrower.Roll_no%TYPE;
    v_book Borrower.Name_of_Book%TYPE;
    v_date_issue Borrower.Date_of_Issue%TYPE;
    v_days NUMBER;
    v_fine NUMBER := 0;
BEGIN
    -- Accept input from user
    v_roll := &Roll_no;
    v_book := '&Name_of_Book';

    -- Fetch issue date
    SELECT Date_of_Issue INTO v_date_issue
    FROM Borrower
    WHERE Roll_no = v_roll AND Name_of_Book = v_book;

    -- Calculate number of days from issue date
    v_days := SYSDATE - v_date_issue;

    DBMS_OUTPUT.PUT_LINE('Total Days since issue: ' || v_days);

    -- Control Structure: Fine Calculation
    IF v_days BETWEEN 15 AND 30 THEN
        v_fine := v_days * 5;
    ELSIF v_days > 30 THEN
        v_fine := v_days * 50;
    ELSE
        v_fine := 0;
    END IF;

    -- Update Book Status to 'R' (Returned)
    UPDATE Borrower
    SET Status = 'R'
    WHERE Roll_no = v_roll AND Name_of_Book = v_book;

    -- Insert Fine Record only if fine > 0
    IF v_fine > 0 THEN
        INSERT INTO Fine (Roll_no, Date_, Amt)
        VALUES (v_roll, SYSDATE, v_fine);
        DBMS_OUTPUT.PUT_LINE('Fine Applied: Rs ' || v_fine);
    ELSE
        DBMS_OUTPUT.PUT_LINE('No fine applicable.');
    END IF;

    COMMIT;

EXCEPTION
    WHEN NO_DATA_FOUND THEN
        DBMS_OUTPUT.PUT_LINE('Error: No such borrower or book found!');
    WHEN OTHERS THEN
        DBMS_OUTPUT.PUT_LINE('Unexpected error: ' || SQLERRM);
END;
/


